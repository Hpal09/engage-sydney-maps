generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  role         String   @default("admin")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
}

model Deal {
  id          String   @id @default(cuid())
  placeId     String   @map("place_id")
  title       String
  description String?
  startsAt    DateTime @map("starts_at")
  endsAt      DateTime @map("ends_at")
  isLive      Boolean  @default(true) @map("is_live")
  tags        String[]
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  Place       Place    @relation(fields: [placeId], references: [id])
}

model Event {
  id          String   @id @default(cuid())
  placeId     String?  @map("place_id")
  title       String
  description String?
  startsAt    DateTime @map("starts_at")
  endsAt      DateTime @map("ends_at")
  isLive      Boolean  @default(true) @map("is_live")
  category    String
  tags        String[]
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  Place       Place?   @relation(fields: [placeId], references: [id])
}

model Place {
  id               String     @id @default(cuid())
  name             String
  shortDescription String?    @map("short_description")
  fullDescription  String?    @map("full_description")
  category         String
  tags             String[]
  lat              Float
  lng              Float
  address          String?
  websiteUrl       String?    @map("website_url")
  phone            String?
  openingHours     String?    @map("opening_hours")
  priceRange       String?    @map("price_range")
  rating           Float?
  imageUrl         String?    @map("image_url")
  isLive           Boolean    @default(true) @map("is_live")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  Deal             Deal[]
  Event            Event[]
  Feedback         Feedback[]
  Building         Building?
}

model MapSettings {
  id           Int      @id @default(1)
  initialZoom  Float    @default(2.5) @map("initial_zoom")
  placeZoom    Float    @default(2.8) @map("place_zoom")
  destZoom     Float    @default(2.8) @map("dest_zoom")
  navZoom      Float    @default(3.0) @map("nav_zoom")
  navStartZoom Float    @default(3.5) @map("nav_start_zoom")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("map_settings")
}

model Feedback {
  id         String   @id @default(cuid())
  placeId    String   @map("place_id")
  rating     Int?     // 1-5 rating
  comment    String?  @db.Text
  category   String?  // e.g., "accuracy", "hours", "info", "general"
  status     String   @default("pending") // pending, reviewed, resolved, dismissed
  isFlagged  Boolean  @default(false) @map("is_flagged")
  isEscalated Boolean @default(false) @map("is_escalated")
  adminNotes String?  @db.Text @map("admin_notes")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at")
  Place      Place    @relation(fields: [placeId], references: [id], onDelete: Cascade)

  @@index([placeId])
  @@index([status])
  @@index([isFlagged])
  @@index([isEscalated])
  @@map("feedback")
}

// Indoor Navigation Models
model Building {
  id        String   @id @default(cuid())
  placeId   String   @unique @map("place_id")
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  Place     Place    @relation(fields: [placeId], references: [id], onDelete: Cascade)
  floors    Floor[]

  @@map("buildings")
}

model Floor {
  id               String            @id @default(cuid())
  buildingId       String            @map("building_id")
  name             String            // "Ground Floor", "Level One", etc.
  floorNumber      Int               @map("floor_number") // 0 for ground, 1 for level one, etc.
  svgPath          String            @map("svg_path") // Path to SVG file
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  Building         Building          @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  connectionPoints ConnectionPoint[]

  @@index([buildingId])
  @@map("floors")
}

model ConnectionPoint {
  id                  String   @id @default(cuid())
  floorId             String   @map("floor_id")
  type                String   // "stairs" or "elevator"
  name                String   // "Stair 1 West", "Elevator 2 East", etc.
  x                   Float    // SVG X coordinate
  y                   Float    // SVG Y coordinate
  connectsToFloorId   String?  @map("connects_to_floor_id") // For stairs/elevators
  isAccessible        Boolean  @default(true) @map("is_accessible") // false for stairs in accessibility mode
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  Floor               Floor    @relation(fields: [floorId], references: [id], onDelete: Cascade)

  @@index([floorId])
  @@index([type])
  @@map("connection_points")
}
